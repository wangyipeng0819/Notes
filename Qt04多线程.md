---
title: Qt04å¤šçº¿ç¨‹
date: 2025-03-13 10:10:18
tags:
- å¤šçº¿ç¨‹
categories:
- Qt
cover: https://bu.dusays.com/2025/03/13/67d28cd25df43.png
---

### <font color="FF0000">ä¸€ã€çŸ¥è¯†å›é¡¾</font>

**1ï¼Œä¸ºä»€ä¹ˆéœ€è¦å¤šçº¿ç¨‹ï¼Ÿ**

- <font color="FF0000">ä»è®¡ç®—æœºåº•å±‚æ¥è¯´</font>ï¼š çº¿ç¨‹å¯ä»¥æ¯”ä½œæ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œçš„æœ€å°å•ä½,çº¿ç¨‹é—´çš„åˆ‡æ¢å’Œè°ƒåº¦çš„æˆæœ¬è¿œè¿œå°äºè¿›ç¨‹ã€‚å¦å¤–ï¼Œå¤šæ ¸ CPU æ—¶ä»£æ„å‘³ç€å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿è¡Œï¼Œè¿™å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚ 
-  <font color="FF0000">ä»å½“ä»£äº’è”ç½‘å‘å±•è¶‹åŠ¿æ¥è¯´</font>**ï¼š** ç°åœ¨çš„ç³»ç»ŸåŠ¨ä¸åŠ¨å°±è¦æ±‚ç™¾ä¸‡çº§ç”šè‡³åƒä¸‡çº§çš„å¹¶å‘é‡ï¼Œè€Œå¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æ­£æ˜¯å¼€å‘é«˜å¹¶å‘ç³»ç»Ÿçš„åŸºç¡€ï¼Œåˆ©ç”¨å¥½å¤šçº¿ç¨‹æœºåˆ¶å¯ä»¥å¤§å¤§æé«˜ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘èƒ½åŠ›ä»¥åŠæ€§èƒ½ã€‚

å†æ·±å…¥åˆ°è®¡ç®—æœºåº•å±‚æ¥æ¢è®¨ï¼š

-  <font color="FF0000">å•æ ¸æ—¶ä»£</font>ï¼šåœ¨å•æ ¸æ—¶ä»£å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ CPU å’Œ IO è®¾å¤‡çš„ç»¼åˆåˆ©ç”¨ç‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå½“åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ä¼šå¯¼è‡´ CPU è®¡ç®—æ—¶ï¼ŒIO è®¾å¤‡ç©ºé—²ï¼›è¿›è¡Œ IO æ“ä½œæ—¶ï¼ŒCPU ç©ºé—²ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¯´è¿™ä¸¤è€…çš„åˆ©ç”¨ç‡ç›®å‰éƒ½æ˜¯ 50%å·¦å³ã€‚ä½†æ˜¯å½“æœ‰ä¸¤ä¸ªçº¿ç¨‹çš„æ—¶å€™å°±ä¸ä¸€æ ·äº†ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ CPU è®¡ç®—æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿›è¡Œ IO æ“ä½œï¼Œè¿™æ ·ä¸¤ä¸ªçš„åˆ©ç”¨ç‡å°±å¯ä»¥åœ¨ç†æƒ³æƒ…å†µä¸‹è¾¾åˆ° 100%äº†ã€‚ 
-  <font color="FF0000">å¤šæ ¸æ—¶ä»£</font>: å¤šæ ¸æ—¶ä»£å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ CPU åˆ©ç”¨ç‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘ä»¬è¦è®¡ç®—ä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬åªç”¨ä¸€ä¸ªçº¿ç¨‹çš„è¯ï¼ŒCPU åªä¼šä¸€ä¸ª CPU æ ¸å¿ƒè¢«åˆ©ç”¨åˆ°ï¼Œè€Œåˆ›å»ºå¤šä¸ªçº¿ç¨‹å°±å¯ä»¥è®©å¤šä¸ª CPU æ ¸å¿ƒè¢«åˆ©ç”¨åˆ°ï¼Œè¿™æ ·å°±æé«˜äº† CPU çš„åˆ©ç”¨ç‡ã€‚

**2ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼š**

è¿›ç¨‹ï¼šä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¦å’Œå…¶ä»–è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦ä½¿ç”¨è¿›ç¨‹é€šä¿¡çš„æœºåˆ¶ã€‚

çº¿ç¨‹ï¼šæ²¡æœ‰è‡ªå·±çš„èµ„æºï¼Œéƒ½æ˜¯å…±äº«è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå¤šä¸ªçº¿ç¨‹é€šä¿¡å­˜åœ¨éšæ‚£ã€‚

PSï¼šåœ¨æ“ä½œç³»ç»Ÿæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹çš„å¼€é”€è¿œå°äºè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ã€‚ï¼ˆå› æ­¤æˆ‘ä»¬å¸¸ç”¨å¤šçº¿ç¨‹å¹¶å‘ï¼Œè€Œéå¤šè¿›ç¨‹å¹¶å‘ï¼‰

ä¸ºäº†æ›´å®¹æ˜“ç†è§£å¤šçº¿ç¨‹çš„ä½œç”¨ï¼Œå…ˆçœ‹ä¸€ä¸ªå®ä¾‹ï¼š

åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œä¸€ä¸ª10sè€—æ—¶çš„æ“ä½œã€‚ï¼ˆé€šè¿‡æŒ‰é’®æ¥è§¦å‘ï¼‰

![](https://bu.dusays.com/2025/03/13/67d28d3da16f3.png)

```c++
#include "threadtest.h"
#include"qthread.h"
Threadtest::Threadtest(QWidget* parent)
    : QMainWindow(parent)
{
    ui.setupUi(this);
    connect(ui.btn_start, &QPushButton::clicked, this, 			 
            &Threadtest::on_pushButton_clicked);
        
}
void Threadtest::on_pushButton_clicked()
{
    QThread::sleep(10);//ä¸»çº¿ç¨‹
}
```

å¯ä»¥çœ‹åˆ°ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ªçº¿ç¨‹éƒ½åœ¨å“åº”10ç§’çš„è€—æ—¶æ“ä½œï¼Œå¯¹äºçº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯exec()å‡½æ•°å°±æœªå“åº”äº†ï¼ˆå°±æ˜¯ä½ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‹–åŠ¨ç•Œé¢æ˜¯æ— ååº”çš„ï¼‰

![](https://bu.dusays.com/2025/03/13/67d28db830489.png)

### <font color="FF0000">äºŒã€çº¿ç¨‹ç±»QThread</font>

Qt ä¸­æä¾›äº†ä¸€ä¸ªçº¿ç¨‹ç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å°±å¯ä»¥åˆ›å»ºå­çº¿ç¨‹äº†ï¼ŒQt ä¸­ä¸€å…±æä¾›äº†ä¸¤ç§åˆ›å»ºå­çº¿ç¨‹çš„æ–¹å¼ï¼Œåè¾¹ä¼šä¾æ¬¡ä»‹ç»å…¶ä½¿ç”¨æ–¹å¼ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç±»ä¸­æä¾›çš„ä¸€äº›å¸¸ç”¨ API å‡½æ•°ï¼š

- **2.1 å¸¸ç”¨å…±ç”¨æˆå‘˜å‡½æ•°**

```c++
// QThread ç±»å¸¸ç”¨ API
// æ„é€ å‡½æ•°
QThread::QThread(QObject *parent = Q_NULLPTR);
// åˆ¤æ–­çº¿ç¨‹ä¸­çš„ä»»åŠ¡æ˜¯ä¸æ˜¯å¤„ç†å®Œæ¯•äº†
bool QThread::isFinished() const;
// åˆ¤æ–­å­çº¿ç¨‹æ˜¯ä¸æ˜¯åœ¨æ‰§è¡Œä»»åŠ¡
bool QThread::isRunning() const;

// Qtä¸­çš„çº¿ç¨‹å¯ä»¥è®¾ç½®ä¼˜å…ˆçº§
// å¾—åˆ°å½“å‰çº¿ç¨‹çš„ä¼˜å…ˆçº§
Priority QThread::priority() const;
void QThread::setPriority(Priority priority);
ä¼˜å…ˆçº§:
    QThread::IdlePriority        --> æœ€ä½çš„ä¼˜å…ˆçº§
    QThread::LowestPriority
    QThread::LowPriority
    QThread::NormalPriority
    QThread::HighPriority
    QThread::HighestPriority
    QThread::TimeCriticalPriority
    QThread::InheritPriority    --> æœ€é«˜çš„ä¼˜å…ˆçº§, é»˜è®¤æ˜¯è¿™ä¸ª


// é€€å‡ºçº¿ç¨‹, åœæ­¢åº•å±‚çš„äº‹ä»¶å¾ªç¯
// é€€å‡ºçº¿ç¨‹çš„å·¥ä½œå‡½æ•°
void QThread::exit(int returnCode = 0);
// è°ƒç”¨çº¿ç¨‹é€€å‡ºå‡½æ•°ä¹‹å, çº¿ç¨‹ä¸ä¼šé©¬ä¸Šé€€å‡ºå› ä¸ºå½“å‰ä»»åŠ¡æœ‰å¯èƒ½è¿˜æ²¡æœ‰å®Œæˆ, è°ƒå›ç”¨è¿™ä¸ªå‡½æ•°æ˜¯
// ç­‰å¾…ä»»åŠ¡å®Œæˆ, ç„¶åé€€å‡ºçº¿ç¨‹, ä¸€èˆ¬æƒ…å†µä¸‹ä¼šåœ¨ exit() åè¾¹è°ƒç”¨è¿™ä¸ªå‡½æ•°
bool QThread::wait(unsigned long time = ULONG_MAX);
```

- **2.2 ä¿¡å·æ§½**

```c++
// å’Œè°ƒç”¨ exit() æ•ˆæœæ˜¯ä¸€æ ·çš„
// è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹å, å†è°ƒç”¨ wait() å‡½æ•°
[slot] void QThread::quit();
// å¯åŠ¨å­çº¿ç¨‹
[slot] void QThread::start(Priority priority = InheritPriority);
// çº¿ç¨‹é€€å‡º, å¯èƒ½æ˜¯ä¼šé©¬ä¸Šç»ˆæ­¢çº¿ç¨‹, ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨è¿™ä¸ªå‡½æ•°
[slot] void QThread::terminate();

// çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡å®Œæˆäº†, å‘å‡ºè¯¥ä¿¡å·
// ä»»åŠ¡å‡½æ•°ä¸­çš„å¤„ç†é€»è¾‘æ‰§è¡Œå®Œæ¯•äº†
[signal] void QThread::finished();
// å¼€å§‹å·¥ä½œä¹‹å‰å‘å‡ºè¿™ä¸ªä¿¡å·, ä¸€èˆ¬ä¸ä½¿ç”¨
[signal] void QThread::started();
```

- **2.3é™æ€å‡½æ•°**

```c++
// è¿”å›ä¸€ä¸ªæŒ‡å‘ç®¡ç†å½“å‰æ‰§è¡Œçº¿ç¨‹çš„QThreadçš„æŒ‡é’ˆ
[static] QThread *QThread::currentThread();
// è¿”å›å¯ä»¥åœ¨ç³»ç»Ÿä¸Šè¿è¡Œçš„ç†æƒ³çº¿ç¨‹æ•° == å’Œå½“å‰ç”µè„‘çš„ CPU æ ¸å¿ƒæ•°ç›¸åŒ
[static] int QThread::idealThreadCount();
// çº¿ç¨‹ä¼‘çœ å‡½æ•°
[static] void QThread::msleep(unsigned long msecs);    // å•ä½: æ¯«ç§’
[static] void QThread::sleep(unsigned long secs);    // å•ä½: ç§’
[static] void QThread::usleep(unsigned long usecs);    // å•ä½: å¾®ç§’
```

### <font color="FF0000">ä¸‰ã€Qtä¸­å®ç°å¤šçº¿ç¨‹çš„ä¸¤ç§æ–¹æ³•</font>

**ğŸ§¡ğŸ§¡3.1.æ´¾ç”ŸQThreadç±»å¯¹è±¡çš„æ–¹æ³•ï¼ˆé‡å†™Runå‡½æ•°ï¼‰**

é¦–å…ˆï¼Œä»¥æ–‡å­—å½¢å¼æ¥è¯´æ˜éœ€è¦å“ªå‡ ä¸ªæ­¥éª¤ã€‚

1. è‡ªå®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ç±»ï¼Œä½¿å…¶ç»§æ‰¿è‡ªQThreadç±»ï¼›
2. åœ¨è‡ªå®šä¹‰ç±»ä¸­è¦†å†™QThreadç±»ä¸­çš„è™šå‡½æ•°run()ã€‚

è¿™å¾ˆå¯èƒ½å°±æ˜¯C++ä¸­å¤šæ€çš„ä½¿ç”¨ã€‚è¡¥å……ä¸€ç‚¹ï¼šQThreadç±»ç»§æ‰¿è‡ªQObjectç±»ã€‚

è¿™é‡Œè¦é‡ç‚¹è¯´ä¸€ä¸‹run()å‡½æ•°äº†ã€‚å®ƒä½œä¸ºçº¿ç¨‹çš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ä»run()å¼€å§‹æ‰§è¡Œï¼Œæˆ‘ä»¬æ‰“ç®—åœ¨çº¿ç¨‹ä¸­å®Œæˆçš„å·¥ä½œéƒ½è¦å†™åœ¨run()å‡½æ•°ä¸­ï¼Œä¸ªäººè®¤ä¸ºå¯ä»¥æŠŠrun()å‡½æ•°ç†è§£ä¸ºçº¿ç¨‹å‡½æ•°ã€‚è¿™ä¹Ÿå°±æ˜¯å­ç±»è¦†å†™åŸºç±»çš„è™šå‡½æ•°ï¼ŒåŸºç±»QThreadçš„run()å‡½æ•°åªæ˜¯ç®€å•å¯åŠ¨exec()æ¶ˆæ¯å¾ªç¯ï¼Œå…³äºè¿™ä¸ªexec()åé¢æœ‰å¾ˆå¤šä¸œè¥¿è¦è®²ï¼Œè¯·åšå¥½å‡†å¤‡ã€‚
é‚£ä¹ˆæˆ‘ä»¬å°±æ¥å°è¯•ç”¨å¤šçº¿ç¨‹å®ç°10sè€—æ—¶çš„æ“ä½œï¼šï¼ˆç”¨æŒ‰é’®è§¦å‘)

- **1ï¸âƒ£åœ¨ç¼–è¾‘å¥½uiç•Œé¢åï¼Œå…ˆåˆ›å»ºä¸€ä¸ªworkThreadçš„ç±»ã€‚ï¼ˆç»§æ‰¿è‡ªQThreadç±»)**

![](https://bu.dusays.com/2025/03/13/67d2986e707f0.png)

- 2ï¸âƒ£**åœ¨workThread1çš„ç±»ä¸­é‡å†™runå‡½æ•°**

åœ¨workThread.hçš„å£°æ˜runå‡½æ•°ï¼š

```c++
#include <qthread.h>
class workThread : public QThread
{
public:
    void run();
};
```

åœ¨workThread.cppä¸­é‡å†™runå‡½æ•°(å¹¶æ‰“å°å­çº¿ç¨‹çš„ID)ï¼š

```c++
#include "workThread.h"
#include"qdebug.h"
workThread::workThread(QObject* parent)
{

}
//é‡å†™runå‡½æ•°
void workThread::run()
{
    qDebug() << "å½“å‰å­çº¿ç¨‹ID:" << QThread::currentThreadId();
    qDebug() << "å¼€å§‹æ‰§è¡Œçº¿ç¨‹";
    QThread::sleep(10);
    qDebug() << "çº¿ç¨‹ç»“æŸ";

}
```

- **3ï¸âƒ£åœ¨ä¸»ç±»ä¸­å¯åŠ¨çº¿ç¨‹**

threadtest.hä¸­å£°æ˜çº¿ç¨‹å’ŒæŒ‰é’®äº‹ä»¶

```c++
#include <QtWidgets/QMainWindow>
#include "ui_threadtest.h"
#include"workThread.h"
#pragma execution_character_set("utf-8")
class Threadtest : public QMainWindow
{
    Q_OBJECT

public:
    Threadtest(QWidget *parent = Q_NULLPTR);

    
private:
    Ui::ThreadtestClass ui;
    void btn_clicked();
	workThread* thread;
};
```

threadtest.cppä¸­å®ç°ï¼Œå¹¶å¯åŠ¨å­çº¿ç¨‹çº¿ç¨‹

```c++
#include "threadtest.h"
#include "qthread.h"
#include "qdebug.h"

Threadtest::Threadtest(QWidget* parent)
    : QMainWindow(parent)
{
    ui.setupUi(this);
    connect(ui.btn_start, &QPushButton::clicked, this, &Threadtest::btn_clicked);
   thread = new workThread(this);  
}
void Threadtest::btn_clicked()
{
    qDebug() << "ä¸»çº¿ç¨‹idï¼š" << QThread::currentThreadId();
    thread->start();//å¯åŠ¨å­çº¿ç¨‹
}
```

å¯ä»¥å®ç°ï¼Œåœ¨æ‰§è¡Œè€—æ—¶æ“ä½œæ—¶ä¹Ÿå¯æ‹–åŠ¨ç•Œé¢ã€‚

![](https://bu.dusays.com/2025/03/13/67d28d3da16f3.png)

![](https://bu.dusays.com/2025/03/13/67d298c015337.png)

**éœ€è¦æ³¨æ„çš„æ˜¯ï¼š**

**åœ¨ä¸»ç¨‹åºä¸­æ·»åŠ workThreadç±»çš„å¤´æ–‡ä»¶æ—¶ï¼Œéœ€è¦å°†workThread.hæ”¾åœ¨threadtest.hä¸­ï¼ˆä¸ç„¶ä¼šæŠ¥é”™ï¼ï¼ï¼ï¼ï¼‰**

![](https://bu.dusays.com/2025/03/13/67d298dace251.png)

ä½¿ç”¨QThread::currentThreadId()æ¥æŸ¥çœ‹å½“å‰çº¿ç¨‹çš„IDï¼Œæ— è®ºæ˜¯å­çº¿ç¨‹è¿˜æ˜¯ä¸»çº¿ç¨‹ï¼Œä¸åŒçº¿ç¨‹å…¶IDæ˜¯ä¸åŒçš„ã€‚æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œå› æ­¤å¯ä»¥ä¸ç»è¿‡å¯¹è±¡æ¥è°ƒç”¨ã€‚

**åˆ›å»ºçš„workThread1ç±»çš„æ‰§è¡Œå®é™…ä¸Šæ˜¯åœ¨ä¸»çº¿ç¨‹é‡Œçš„ï¼Œåªæœ‰runå‡½æ•°å†…çš„ç¨‹åºæ‰ä¼šåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œï¼ï¼ˆå³QThreadåªæ˜¯çº¿ç¨‹çš„ç®¡ç†ç±»ï¼Œåªæœ‰run()æ‰æ˜¯æˆ‘ä»¬çš„çº¿ç¨‹å‡½æ•°ï¼‰**

å› æ­¤åœ¨QThreadï¼ˆå³åˆ›å»ºçš„ç±»ï¼‰ä¸­çš„æˆå‘˜å˜é‡å±äºä¸»çº¿ç¨‹ï¼Œåœ¨è®¿é—®å‰éœ€è¦åˆ¤æ–­è®¿é—®æ˜¯å¦å®‰å…¨ã€‚runï¼ˆï¼‰ä¸­åˆ›å»ºçš„å˜é‡å±äºå­çº¿ç¨‹ã€‚

çº¿ç¨‹ä¹‹é—´å…±äº«å†…å­˜æ˜¯ä¸å®‰å…¨çš„ï¼ˆç”±äºå¤šçº¿ç¨‹äº‰å¤ºèµ„æºä¼šå½±å“æ•°æ®å®‰å…¨é—®é¢˜ï¼‰ï¼Œè§£å†³çš„åŠæ³•å°±æ˜¯è¦ä¸Šé”ã€‚

**<p align = "center">å…³äºäº’æ–¥é”</p>**

ä¸ªäººè®¤ä¸ºï¼Œexec()è¿™ä¸ªç‚¹å¤ªé‡è¦äº†ï¼ŒåŒæ—¶è¿˜ä¸å¤ªå®¹æ˜“ç†è§£ã€‚

æ¯”å¦‚ä¸‹é¢çš„ä»£ç ä¸­æœ‰ä¸¤ä¸ªexec()ï¼Œæˆ‘ä»¬è®²â€œä¸€å±±ä¸å®¹äºŒè™â€ï¼Œæ”¾åœ¨è¿™é‡Œå°±æ˜¯è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸­ä¸èƒ½åŒæ—¶è¿è¡Œä¸¤ä¸ªexec()ï¼Œå¦åˆ™å°±ä¼šé€ æˆå¦ä¸€ä¸ªæ¶ˆæ¯å¾ªç¯å¾—ä¸åˆ°æ¶ˆæ¯ã€‚åƒQDialogæ¨¡æ€çª—å£ä¸­çš„exec()å°±æ˜¯å› ä¸ºåœ¨ä¸»çº¿ç¨‹ä¸­åŒæ—¶å¼€äº†ä¸¤ä¸ªexec()ï¼Œå¯¼è‡´ä¸»çª—å£çš„exec()æ¥æ”¶ä¸åˆ°ç”¨æˆ·çš„æ¶ˆæ¯äº†ã€‚ä½†æ˜¯ï¼ä½†æ˜¯ï¼ä½†æ˜¯ï¼æˆ‘ä»¬è¿™é‡Œå´æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰å‡ºç°åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ˜¯ä¸»çº¿ç¨‹ä¸­çš„exec()ï¼Œä¸€ä¸ªæ˜¯å­çº¿ç¨‹ä¸­çš„exec()ã€‚

```c++
#include <QApplication>
#include <QThread>
#include <QDebug>
 
class MyThread:public QThread
{
    public:
        void run()
        {
            qDebug()<<"child thread begin"<<endl;
            qDebug()<<"child thread"<<QThread::currentThreadId()<<endl;
            QThread::sleep(5);
            qDebugu()<<"QThread end"<<endl;
            this->exec();
        }
};
 
int main(int argc,char ** argv) //mian()ä½œä¸ºä¸»çº¿ç¨‹
{
    QApplication app(argc,argv);
 
    MyThread thread; //åˆ›å»ºä¸€ä¸ªQThreadæ´¾ç”Ÿç±»å¯¹è±¡å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå­çº¿ç¨‹
    thread.start(); //å¯åŠ¨å­çº¿ç¨‹ï¼Œç„¶åä¼šè‡ªåŠ¨è°ƒç”¨çº¿ç¨‹å‡½æ•°run()
 
    qDebug()<<"main thread"<<QThread::currentThreadId()<<endl;
    QThread::sleep(5);
    qDebugu()<<"main thread"<<QThread::currentThreadId()<<endl;
 
    thread.quit(); //ä½¿ç”¨quit()æˆ–è€…exit()ä½¿å¾—å­çº¿ç¨‹èƒ½å¤Ÿé€€å‡ºæ¶ˆæ¯å¾ªç¯ï¼Œè€Œä¸è‡³äºé™·åœ¨å­çº¿ç¨‹ä¸­
    thread.wait(); //ç­‰å¾…å­çº¿ç¨‹é€€å‡ºï¼Œç„¶åå›æ”¶èµ„æº
                   //thread.wait(5000); //è®¾å®šç­‰å¾…çš„æ—¶é—´
    
    return app.exec();    
}
```

å¦‚æœrun()å‡½æ•°ä¸­æ²¡æœ‰æ‰§è¡Œexec()æ¶ˆæ¯å¾ªç¯å‡½æ•°ï¼Œé‚£ä¹ˆrun()æ‰§è¡Œå®Œäº†ä¹Ÿå°±æ„å‘³ç€å­çº¿ç¨‹é€€å‡ºäº†ã€‚ä¸€èˆ¬åœ¨å­çº¿ç¨‹é€€å‡ºçš„æ—¶å€™éœ€è¦ä¸»çº¿ç¨‹å»å›æ”¶èµ„æºï¼Œå¯ä»¥è°ƒç”¨QThreadçš„wait()ï¼Œä½¿ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹é€€å‡ºï¼Œç„¶åå›æ”¶èµ„æºã€‚è¿™é‡Œwait()æ˜¯ä¸€ä¸ªé˜»å¡å‡½æ•°ï¼Œæœ‰ç‚¹åƒC++11ä¸­çš„join()å‡½æ•°ã€‚

ä½†æ˜¯ï¼ä½†æ˜¯ï¼ä½†æ˜¯ï¼run()å‡½æ•°ä¸­è°ƒç”¨äº†exec()å‡½æ•°ï¼Œexec()æ˜¯ä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ï¼Œä¹Ÿå¯ä»¥å«åšäº‹ä»¶å¾ªç¯ï¼Œä¹Ÿæ˜¯ä¼šé˜»å¡çš„ï¼Œç›¸å½“äºä¸€ä¸ªæ­»å¾ªç¯ä½¿å­çº¿ç¨‹å¡åœ¨è¿™é‡Œæ°¸ä¸é€€å‡ºï¼Œå¿…é¡»è°ƒç”¨QThreadçš„quit()å‡½æ•°æˆ–è€…exit()å‡½æ•°æ‰å¯ä»¥ä½¿å­çº¿ç¨‹é€€å‡ºæ¶ˆæ¯å¾ªç¯ï¼Œå¹¶ä¸”æœ‰æ—¶è¿˜ä¸æ˜¯é©¬ä¸Šå°±é€€å‡ºï¼Œéœ€è¦ç­‰åˆ°CPUçš„æ§åˆ¶æƒäº¤ç»™çº¿ç¨‹çš„exec()ã€‚

æ‰€ä»¥å…ˆè¦thread.quit();ä½¿é€€å‡ºå­çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯ï¼Œ ç„¶åthread.wait();åœ¨ä¸»çº¿ç¨‹ä¸­å›æ”¶å­çº¿ç¨‹çš„èµ„æºã€‚

**å€¼å¾—æ³¨æ„çš„æœ‰ä¸¤ç‚¹**ï¼šå­çº¿ç¨‹çš„exet()æ¶ˆæ¯å¾ªç¯å¿…é¡»åœ¨run()å‡½æ•°ä¸­è°ƒç”¨ï¼›å¦‚æœæ²¡æœ‰æ¶ˆæ¯å¾ªç¯çš„è¯ï¼Œåˆ™æ²¡æœ‰å¿…è¦è°ƒç”¨quit( )æˆ–è€…exit()ï¼Œå› ä¸ºè°ƒç”¨äº†ä¹Ÿä¸ä¼šèµ·ä½œç”¨ã€‚

ç¬¬ä¸€ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼éœ€è¦åœ¨run()ä¸­æ˜¾å¼è°ƒç”¨exec()ï¼Œä½†æ˜¯exec()æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Œç›®å‰è¿˜çœ‹ä¸å‡ºæ¥ï¼Œéœ€è¦åœ¨ç¬¬äºŒç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ä¸­æ‰èƒ½çŸ¥é“ã€‚

------

 **ğŸ’œğŸ’œ3.2.ä½¿ç”¨ä¿¡å·ä¸æ§½æ–¹å¼æ¥å®ç°å¤šçº¿ç¨‹**

 åˆšè®²å®Œä½¿ç”¨QThreadæ´¾ç”Ÿç±»å¯¹è±¡çš„æ–¹æ³•åˆ›å»ºçº¿ç¨‹ï¼Œç°åœ¨å°±è¦æ¥è¯´å®ƒä¸€ç‚¹åè¯ã€‚è¿™ç§æ–¹æ³•å­˜åœ¨ä¸€ä¸ªå±€é™æ€§ï¼Œåªæœ‰ä¸€ä¸ªrun()å‡½æ•°èƒ½å¤Ÿåœ¨çº¿ç¨‹ä¸­å»è¿è¡Œï¼Œä½†æ˜¯å½“æœ‰å¤šä¸ªå‡½æ•°åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œæ—¶ï¼Œå°±æ²¡åŠæ³•äº†ï¼Œè‡³å°‘å®ç°èµ·æ¥å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥ï¼Œå½“å½“å½“å½“ï¼Œä¸‹é¢å°†ä»‹ç»ç¬¬äºŒç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼š**ä½¿ç”¨ä¿¡å·ä¸æ§½çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æŠŠåœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„å‡½æ•°ï¼ˆæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºçº¿ç¨‹å‡½æ•°ï¼‰å®šä¹‰ä¸ºä¸€ä¸ªæ§½å‡½æ•°ã€‚**

ä»ç„¶æ˜¯é¦–å…ˆä»¥æ–‡å­—å½¢å¼è¯´æ˜è¿™ç§æ–¹æ³•çš„å‡ ä¸ªæ­¥éª¤ã€‚

- åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»(mywork)ï¼Œè®©è¿™ä¸ªç±»ä» QObject æ´¾ç”Ÿï¼Œåœ¨è¿™ä¸ªç±»ä¸­æ·»åŠ ä¸€ä¸ªå…¬å…±çš„æˆå‘˜å‡½æ•°(working)ï¼Œå‡½æ•°ä½“å°±æ˜¯æˆ‘ä»¬è¦å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘

```c++
class MyWork:public QObject
{
public:
    .......
    // å‡½æ•°åè‡ªå·±æŒ‡å®š, å«ä»€ä¹ˆéƒ½å¯ä»¥, å‚æ•°å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚æ·»åŠ 
    void working();
}
```

- åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ª QThread å¯¹è±¡ï¼Œè¿™å°±æ˜¯å­çº¿ç¨‹çš„å¯¹è±¡

```c++
QThread* sub = new QThread;
```

- åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºå·¥ä½œçš„ç±»å¯¹è±¡ï¼ˆåƒä¸‡ä¸è¦æŒ‡å®šç»™åˆ›å»ºçš„å¯¹è±¡æŒ‡å®šçˆ¶å¯¹è±¡ï¼‰

```c++
MyWork* work = new MyWork(this);    // error
MyWork* work = new MyWork;          // ok
```

- å°† MyWork å¯¹è±¡ç§»åŠ¨åˆ°åˆ›å»ºçš„å­çº¿ç¨‹å¯¹è±¡ä¸­ï¼Œéœ€è¦è°ƒç”¨ QObject ç±»æä¾›çš„ moveToThread() æ–¹æ³•

```c++
// void QObject::moveToThread(QThread *targetThread);
// å¦‚æœç»™workæŒ‡å®šäº†çˆ¶å¯¹è±¡, è¿™ä¸ªå‡½æ•°è°ƒç”¨å°±å¤±è´¥äº†
// æç¤ºï¼š QObject::moveToThread: Cannot move objects with a parent
work->moveToThread(sub);    // ç§»åŠ¨åˆ°å­çº¿ç¨‹ä¸­å·¥ä½œ
```

- å¯åŠ¨å­çº¿ç¨‹ï¼Œè°ƒç”¨ start(), è¿™æ—¶å€™çº¿ç¨‹å¯åŠ¨äº†ï¼Œä½†æ˜¯ç§»åŠ¨åˆ°çº¿ç¨‹ä¸­çš„å¯¹è±¡å¹¶æ²¡æœ‰å·¥ä½œ
- è°ƒç”¨ MyWork ç±»å¯¹è±¡çš„å·¥ä½œå‡½æ•°ï¼Œè®©è¿™ä¸ªå‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œè¿™æ—¶å€™æ˜¯åœ¨ç§»åŠ¨åˆ°çš„é‚£ä¸ªå­çº¿ç¨‹ä¸­è¿è¡Œçš„

**ä»£ç å®ä¾‹ï¼š**

- 1ï¸âƒ£**åˆ›å»ºä¸€ä¸ªworkThreadçš„ç±»ã€‚ï¼ˆç»§æ‰¿è‡ªQThreadç±»ï¼‰**

å®šä¹‰æ§½å‡½æ•°ï¼ˆ**å­çº¿ç¨‹æ‰§è¡Œçš„ç¨‹åºéƒ½å¯ä»¥æ”¾åœ¨æ§½å‡½æ•°ä¸­**ï¼‰

```c++
//workThread.cppï¼ˆå…ˆåœ¨workThread.hä¸­å£°æ˜æ§½å‡½æ•°ï¼‰void workThread:: doWork()
  {
      qDebug()<<"å½“å‰çº¿ç¨‹ID:"<<QThread::currentThreadId();
      qDebug()<<"å¼€å§‹æ‰§è¡Œ";
      QThread::sleep(10);    
      qDebug()<<"ç»“æŸæ‰§è¡Œ";
  }
```

- 2ï¸âƒ£**ä¸»çº¿ç¨‹ä¸­åˆ†åˆ«å¯¹workThreadç±»å’ŒQTreadç±»å®ä¾‹åŒ–**

åœ¨threadtest.hä¸­å£°æ˜

```c++
#include <QtWidgets/QMainWindow>
#include "ui_threadtest.h"
#include"workThread.h"
#include"qthread.h"
#pragma execution_character_set("utf-8")
class Threadtest : public QMainWindow
{
    Q_OBJECT

public:
    Threadtest(QWidget *parent = Q_NULLPTR);  
private:
    Ui::ThreadtestClass ui;
    void btn_clicked();
    workThread* thread; //å®ä¾‹åŒ–workThreadç±»
    QThread* qthread;   //å®ä¾‹åŒ–QThreadç±»
};
```

åœ¨threadtest.cppä¸­å®ç°**å¹¶é€šè¿‡moveToThreadå°†è‡ªå·±æ”¾åˆ°çº¿ç¨‹QThreadå¯¹è±¡ä¸­ï¼Œæœ€åå¯åŠ¨çº¿ç¨‹**

```c++
#include "threadtest.h"
#include"qthread.h"
#include"qdebug.h"

Threadtest::Threadtest(QWidget* parent)
    : QMainWindow(parent)
{
    ui.setupUi(this);
   
    //ä¸èƒ½æŒ‡å®šè‡ªå®šä¹‰ç±»çš„å¯¹è±¡çš„çˆ¶ç±»ä¸ºwidgetï¼Œå³æ²¡æœ‰thisï¼ˆå¾ˆé‡è¦ï¼ï¼ï¼ï¼ï¼‰
   thread = new workThread();  
   qthread1 = new QThread(this);
   thread->moveToThread(qthread1);
   //çº¿ç¨‹ç»“æŸæ—¶æ¸…ç†çº¿ç¨‹å†…å­˜
   connect(qthread1, &QThread::finished, qthread1, &QThread::deleteLater);
   //å°†æŒ‰é’®äº‹ä»¶ï¼ˆä¿¡å·ï¼‰ç»‘å®šæ§½å‡½æ•°
   connect(ui.btn_start, &QPushButton::clicked, thread, &workThread::dowork);
   //æ‰“å°ä¸»çº¿ç¨‹
   connect(ui.btn_start, &QPushButton::clicked, [=]() {
       qDebug() << "ä¸»çº¿ç¨‹idï¼š" << QThread::currentThreadId();
       });
   //çº¿ç¨‹å¯åŠ¨
   qthread1->start();
}
```

åœ¨è¿è¡Œæ§½å‡½æ•°æ—¶ï¼Œä¸èƒ½åœ¨æ­¤ç›´æ¥è°ƒç”¨ï¼ˆå¦‚ï¼šthread1->doWork()ï¼‰ã€‚è€Œæ˜¯ç”¨connectè¿æ¥ä¿¡å·å’Œæ§½

è¿™é‡Œå°†æ‰“å°ä¸»çº¿ç¨‹å’Œæ§½å‡½æ•°éƒ½ç»‘å®šåœ¨äº†buttonæŒ‰é’®çš„clickäº‹ä»¶ä¸Šäº†ã€‚

![](https://bu.dusays.com/2025/03/13/67d28d3da16f3.png)

![](https://bu.dusays.com/2025/03/13/67d2995e14e1b.png)

- **å­çº¿ç¨‹ä¸­ä¸èƒ½æ“ä½œUI**

Qtåˆ›å»ºçš„å­çº¿ç¨‹ä¸­æ˜¯ä¸èƒ½å¯¹UIå¯¹è±¡è¿›è¡Œä»»ä½•æ“ä½œçš„ï¼Œå³QWidgetåŠå…¶æ´¾ç”Ÿç±»å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯æˆ‘æ‰çš„ç¬¬ä¸€ä¸ªå‘ã€‚å¯èƒ½æ˜¯ç”±äºè€ƒè™‘åˆ°å®‰å…¨æ€§çš„é—®é¢˜ï¼Œæ‰€ä»¥Qtä¸­å­çº¿ç¨‹ä¸èƒ½æ‰§è¡Œä»»ä½•å…³äºç•Œé¢çš„å¤„ç†ï¼ŒåŒ…æ‹¬æ¶ˆæ¯æ¡†çš„å¼¹å‡ºã€‚æ­£ç¡®çš„æ“ä½œåº”è¯¥æ˜¯é€šè¿‡ä¿¡å·æ§½ï¼Œå°†ä¸€äº›å‚æ•°ä¼ é€’ç»™ä¸»çº¿ç¨‹ï¼Œè®©ä¸»çº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯Controllerï¼‰å»å¤„ç†ã€‚

- **è‡ªå®šä¹‰çš„ç±»ä¸èƒ½æŒ‡å®šçˆ¶å¯¹è±¡**

æ¯”å¦‚ä¸Šé¢ç¨‹åºä¸­çš„ï¼šï¼ˆä¸èƒ½æŒ‡å®šè‡ªå®šä¹‰ç±»å¯¹è±¡ä¸ºwidgetï¼Œå³ä¸å¯ä»¥åŠ thisï¼‰

```c++
thread1=new workThread1();//åˆå§‹åŒ–
```

- **QThreadå’Œconnectçš„å…³ç³»**

æˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„æ˜¯QThreadäºconnectçš„å…³ç³»ï¼Œåœ¨ä½¿ç”¨connectå‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠæœ€åä¸€ä¸ªå‚æ•°å¿½ç•¥æ‰ã€‚è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦çœ‹ä¸‹å‡½æ•°åŸå‹ï¼š

```c++
[static] QMetaObject::Connection QObject::connect(const QObject *sender, const char *signal, const QObject *receiver, const char *method, Qt::ConnectionType type = Qt::AutoConnection)
```

å¯ä»¥çœ‹åˆ°ï¼Œæœ€åä¸€ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯è¿æ¥çš„æ–¹å¼ã€‚æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨åˆ°æ–¹å¼æ˜¯æœ‰ä¸‰ç§ï¼š

**è‡ªåŠ¨è¿æ¥(AutoConnection)**ï¼šé»˜è®¤çš„è¿æ¥æ–¹å¼ã€‚å¦‚æœä¿¡å·ä¸æ§½ï¼Œä¹Ÿå°±æ˜¯å‘é€è€…ä¸æ¥å—è€…åœ¨åŒä¸€çº¿ç¨‹ï¼Œç­‰åŒäºç›´æ¥è¿æ¥ï¼›å¦‚æœå‘é€è€…ä¸æ¥å—è€…å¤„åœ¨ä¸åŒçº¿ç¨‹ï¼Œç­‰åŒäºé˜Ÿåˆ—è¿æ¥ã€‚

**ç›´æ¥è¿æ¥(Direct Connection)**ï¼šå½“ä¿¡å·å‘å°„æ—¶ï¼Œæ§½å‡½æ•°å°†ç›´æ¥è¢«è°ƒç”¨ã€‚æ— è®ºæ§½å‡½æ•°æ‰€å±å¯¹è±¡åœ¨å“ªä¸ªçº¿ç¨‹ï¼Œæ§½å‡½æ•°éƒ½åœ¨å‘å°„è€…æ‰€åœ¨çº¿ç¨‹æ‰§è¡Œã€‚

**é˜Ÿåˆ—è¿æ¥(Queued Connection)**ï¼šå½“æ§åˆ¶æƒå›åˆ°æ¥å—è€…æ‰€åœ¨çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯å¼ï¼Œæ§½å‡½æ•°è¢«è°ƒç”¨ã€‚æ§½å‡½æ•°åœ¨æ¥æ”¶è€…æ‰€åœ¨çº¿ç¨‹æ‰§è¡Œã€‚

**å› æ­¤æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼š**

1. ä¸»çº¿ç¨‹å¯¹è±¡å‘å‡ºä¿¡å·è¿æ¥QThreadå­ç±»çš„æ§½å‡½æ•°ï¼ŒQThreadå­ç±»å¯¹è±¡åœ¨ä¸»çº¿ç¨‹åˆ›å»ºçš„ï¼Œæ— è®ºé‡‡ç”¨å“ªç§è¿æ¥æ–¹å¼ï¼Œæ§½å‡½æ•°éƒ½å±åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ã€‚ï¼ˆå¦‚æœåœ¨é‡å†™çš„runå‡½æ•°ä¸­è°ƒç”¨äº†æ§½å‡½æ•°ï¼Œæ­¤æ—¶æ§½å‡½æ•°åœ¨æ¬¡çº¿ç¨‹æ‰§è¡Œï¼Œæ³¨æ„æ•°æ®å®‰å…¨ï¼‰ã€‚
2. æ¬¡çº¿ç¨‹runä¸­å‘å‡ºä¿¡å·ï¼Œæ§½å‡½æ•°å¯ä»¥æ˜¯å‘å‡ºä¿¡å·å¯¹è±¡è‡ªèº«çš„æ§½å‡½æ•°ï¼Œè‡ªå‘è‡ªæ”¶ï¼Œéƒ½æ˜¯æ¬¡çº¿ç¨‹ä¸­è¡Œã€‚æ§½å‡½æ•°æ˜¯QThreadå­ç±»çš„æ§½å‡½æ•°ï¼Œæˆ–è€…ä¸»çº¿ç¨‹ä¸­å¯¹è±¡çš„æ§½å‡½æ•°ï¼Œè¿™é‡Œçš„ç§æƒ…å†µéœ€è¦ä½ æŒ‡æ˜runä¸­connectä¸­çš„è¿æ¥æ–¹å¼ï¼Œç›´è¿åˆ™è¯¥æ§½å‡½æ•°åœ¨æ¬¡çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆå¯èƒ½å‘ç”Ÿæ•°æ®å®‰å…¨é—®é¢˜ï¼‰ï¼Œåˆ—é˜Ÿåˆ™åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œã€‚

**ğŸ§¡ğŸ§¡æ€»ç»“ä¸€ä¸‹ï¼š**

- ä¸€å®šè¦ç”¨ä¿¡å·æ§½æœºåˆ¶ï¼Œåˆ«æƒ³ç€ç›´æ¥è°ƒç”¨ï¼Œä½ ä¼šå‘ç°å¹¶æ²¡æœ‰åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œã€‚
- è‡ªå®šä¹‰çš„ç±»ä¸èƒ½æŒ‡å®šçˆ¶å¯¹è±¡ï¼Œå› ä¸ºmoveToThreadå‡½æ•°ä¼šå°†çº¿ç¨‹å¯¹è±¡æŒ‡å®šä¸ºè‡ªå®šä¹‰çš„ç±»çš„çˆ¶å¯¹è±¡ï¼Œå½“è‡ªå®šä¹‰çš„ç±»å¯¹è±¡å·²ç»æœ‰äº†çˆ¶å¯¹è±¡ï¼Œå°±ä¼šæŠ¥é”™ã€‚
- å½“ä¸€ä¸ªå˜é‡éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹é—´è¿›è¡Œè®¿é—®æ—¶ï¼Œæœ€å¥½åŠ ä¸Švoliateå…³é”®å­—ï¼Œä»¥å…è¯»å–åˆ°çš„æ˜¯æ—§çš„å€¼ã€‚å½“ç„¶ï¼ŒQtä¸­æä¾›äº†çº¿ç¨‹åŒæ­¥çš„æ”¯æŒï¼Œæ¯”å¦‚äº’æ–¥é”ä¹‹ç±»çš„ç©æ„ï¼Œä½¿ç”¨è¿™äº›æ–¹å¼æ¥è®¿é—®å˜é‡ä¼šæ›´åŠ å®‰å…¨ã€‚
- åˆ†æå‘å‡ºä¿¡å·çš„å¯¹è±¡å’Œæ¥å—ä¿¡å·å¯¹è±¡æ‰€åœ¨çš„çº¿ç¨‹ï¼Œå†é€šè¿‡è¿æ¥æ–¹å¼ï¼Œåˆ¤æ–­æ§½å‡½æ•°åœ¨å“ªé‡Œæ‰§è¡Œã€‚ï¼ˆå°ç™½åœ¨ä½¿ç”¨ä¸­å°±æœ‰åœ¨runä¸­åˆ›å»ºå¯¹è±¡-å› ä¸ºå¤šéæ§½å‡½æ•°éƒ½éœ€è¦åœ¨æ¬¡çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé€šè¿‡æŒ‡é’ˆå¼•å‡ºæ¥ï¼Œå†connectä¸å…¶ä»–æ¨¡å—äº¤äº’ï¼ŒæŒ‡æ˜è¿æ¥æ–¹å¼ä¸ºåˆ—é˜Ÿå½¢å¼ï¼Œæ‰€ä»¥ç›¸å…³æ‰§è¡Œéƒ½åœ¨æ¬¡çº¿ç¨‹ä¸­æ‰§è¡Œï¼‰ã€‚è¿™é‡Œè®°ä½moveToThreadåªèƒ½å°†æ§½å‡½æ•°ç§»åˆ°æ¬¡çº¿ç¨‹ä¸­ã€‚

**<p align = "center">å¯åŠ¨å¤šçº¿ç¨‹çš„æ“ä½œæ€è·¯</p>**

å¦‚æœæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæ’åºæ“ä½œï¼Œå³é¦–å…ˆè·å–1000ä¸ªéšæœºæ•°ï¼Œç„¶åç”¨å†’æ³¡æ’åºæ³•å¯¹å…¶è¿›è¡Œæ’åºã€‚

**æ–¹æ³•ä¸€ï¼šé‡å†™runå‡½æ•°**

 **æ€è·¯ï¼šï¼ˆæ„å»ºä¸¤ä¸ªå­çº¿ç¨‹ï¼Œä¸€ä¸ªç”¨äºç”Ÿæˆéšæœºæ•°ï¼Œä¸€ä¸ªç”¨äºå†’æ³¡æ’åºï¼Œä¸»çº¿ç¨‹è´Ÿè´£è°ƒç”¨ï¼‰**

- æ–°å»ºmyThreadç±»ï¼Œåœ¨è¯¥ç±»ä¸­é‡å†™runå‡½æ•°ï¼ˆå³ç”Ÿéšæœºæ•°ï¼‰ã€‚éœ€è¦å…ˆæ¥æ”¶ä¸»çº¿ç¨‹å‘é€çš„è¦ç”Ÿæˆéšæœºæ•°çš„ä¸ªæ•°ï¼ˆscvnumä¿¡å·ï¼‰åå†è¿›è¡Œç”Ÿæˆï¼Œç”Ÿæˆå®Œæˆä»¥åå‘é€ä¸€ä¸ªsendArrayä¿¡å·
- æ–°å»ºBubbleSortç±»ï¼Œåœ¨è¯¥ç±»ä¸­é‡å†™runå‡½æ•°ï¼ˆå³å†’æ³¡æ’åºç®—æ³•ï¼‰ã€‚éœ€è¦å…ˆæ¥æ”¶å·²ç»ç”Ÿæˆçš„éšæœºæ•°ï¼ˆrcvArrayä¿¡å·ï¼‰åå†è¿›è¡Œæ’åºï¼Œæ’åºå®Œæˆåå‘é€ä¸€ä¸ªfinishä¿¡å·
- ä¸»çº¿ç¨‹é€šè¿‡statingä¿¡å·å‘Šè¯‰myThreadçº¿ç¨‹è¦ç”Ÿæˆçš„ä¸ªæ•°ï¼Œç„¶åmyThreadçº¿ç¨‹é€šè¿‡scvnumä¿¡å·æ¥æ”¶ï¼Œè¿›è¡Œç”Ÿæˆéšæœºæ•°ï¼Œç„¶åå†å‘é€ä¸€ä¸ªsendArrayä¿¡å·ï¼ˆå³ç”Ÿæˆéšæœºæ•°é›†åˆï¼‰
- BubbleSortå­çº¿ç¨‹é€šè¿‡rcvArrayä¿¡å·æ¥æ”¶sendArrayä¿¡å·ï¼ˆå³æ¥æ”¶éšæœºæ•°ï¼‰ç„¶åè¿›è¡Œå†’æ³¡æ’åºï¼Œå†å‘é€finishä¿¡å·
- ä¸»çº¿ç¨‹æ¥æ”¶åˆ°finishä¿¡å·åï¼Œå°†æ’åºåçš„éšæœºæ•°æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š

**å®ç°ä»£ç ï¼š**

- **å­çº¿ç¨‹.h**

```c++
#pragma once
#include"qthread.h"
#include"qvector.h"
//æ–°å»ºéšæœºæ•°ç±»
class myThread :
    public QThread
{
    Q_OBJECT
public:
    myThread(QObject* parent = nullptr);
    void scvnum(int num);//æ¥æ”¶æ•°å­—
protected:
    void run();
signals:
    void sendArray(QVector<int>num);//å‘é€
private:
    int m_num;
};

//æ–°å»ºå†’æ³¡æ’åºç±»
class BubbleSort :
    public QThread
{
    Q_OBJECT
public:
    BubbleSort(QObject* parent = nullptr);
    void rcvArray(QVector<int>list);//è¦æ¥æ”¶çš„æ˜¯æ’åºçš„æ•°
protected:
    void run();
signals:
    void finish(QVector<int>list);//æ’åºå®Œæˆåå‘é€ä¸€ä¸ªfinishä¿¡å·
private:
    QVector<int>m_list;
};
```

- **å­çº¿ç¨‹.cpp**

```c++
#include "myThread.h"
#include"qelapsedtimer.h"
#include"qdebug.h"

myThread::myThread(QObject* parent) :QThread(parent)
{

}
BubbleSort::BubbleSort(QObject* parent) : QThread(parent)
{

}


void myThread::scvnum(int num)
{
    m_num = num;
}

void myThread::run()
{
    qDebug() << "child thread id" << QThread::currentThreadId();
    QVector<int> list;
    QElapsedTimer time;
    time.start();
    for (int i = 0; i < m_num; i++)
    {
        list.push_back(qrand() % 100000);
    }
    int milsec = time.elapsed();
    qDebug() << "The number of" << m_num << "generated";
    qDebug() << "shared" << milsec << "second";
    emit sendArray(list);
}

void BubbleSort::rcvArray(QVector<int> list)
{
    m_list = list;
}

void BubbleSort::run()
{
    qDebug() << "BubbleSort thread id:" << QThread::currentThreadId();
    QElapsedTimer time;
    time.start();
    int temp;
    for (int i = 0; i < m_list.size(); ++i)
    {
        for (int j = 0; j < m_list.size()-i-1; ++j)
        {
            if (m_list[j] > m_list[j + 1])
            {
                temp = m_list[j];
                m_list[j] = m_list[j + 1];
                m_list[j + 1] = temp;
            }
        }
    }
    int milsec = time.elapsed();
    qDebug() << "shared" << milsec << "second";
    emit finish(m_list);
}
```

- **ä¸»çº¿ç¨‹.h**

```c++
#include <QtWidgets/QWidget>
#include"ui_list.h"

class list : public QWidget
{
    Q_OBJECT

public:
    list(QWidget *parent = Q_NULLPTR);
signals:
    void stating(int num);//è®¾ç½®è¦ç”Ÿæˆéšæœºæ•°ä¸ªæ•°

private:
    Ui::listClass ui;
};
```

- **ä¸»çº¿ç¨‹.cpp**

```c++
#include "list.h"
#include"myThread.h"
list::list(QWidget *parent)
    : QWidget(parent)
{
    ui.setupUi(this);
    //1.åˆ›å»ºå­çº¿ç¨‹å¯¹è±¡
    myThread* thread = new myThread();
    BubbleSort* bub_thread = new BubbleSort();
    //å‘å­çº¿ç¨‹å‘é€è¦ç”Ÿæˆçš„éšæœºæ•°ä¸ªæ•°
    connect(this,&list::stating, thread, &myThread::scvnum);
    //2å¯åŠ¨å­çº¿ç¨‹
    connect(ui.pushButton, &QPushButton::clicked,  [=]() {
        emit stating(1000);//ä¸»çº¿ç¨‹è®¾ç½®å­çº¿ç¨‹éšæœºæ•°çš„ä¸ªæ•°
        thread->start();
    
        
        });
    connect(thread, &myThread::sendArray, bub_thread, &BubbleSort::rcvArray);

    //3æ¥æ”¶å­çº¿ç¨‹å‘é€çš„æ•°æ®
    connect(thread, &myThread::sendArray,  [=](QVector<int>list) {
        for (int i = 0; i < list.size(); ++i)
        {
            ui.randlist->addItem(QString::number(list.at(i)));
        }
        });
    connect(thread, &myThread::sendArray, [=](QVector<int>list){
        bub_thread->start();
        });
    connect(bub_thread, &BubbleSort::finish, [=](QVector<int>list) {
        for (int i = 0; i < list. size(); ++i)
        {
            ui.bubblelist->addItem(QString::number(list.at(i)));
        }
        });
}
```

![](https://bu.dusays.com/2025/03/13/67d299b1220c9.gif)

**æ–¹æ³•äºŒï¼šmoveToThread()** 

**æ€è·¯ï¼š**

- æ–°å»ºmyThreadç±»ï¼Œç”¨äºç”Ÿæˆéšæœºæ•°ï¼ˆworkingå‡½æ•°ï¼‰ï¼Œåœ¨æ¥å—åˆ°ä¸»çº¿ç¨‹çš„ä¿¡å·åå¼€å§‹ç”Ÿæˆéšæœºæ•°
- æ–°å»ºBubbleSortç±»ï¼Œç”¨äºæ’åº(workingå‡½æ•°ï¼‰ï¼Œåœ¨æ¥å—åˆ°myThreadç±»ç”Ÿæˆçš„éšæœºæ•°åå¼€å§‹æ’åº
- æœ€åæ˜¾ç¤ºåœ¨ç•Œé¢

**ä»£ç å®ç°ï¼š**

- **å­çº¿ç¨‹.h**

```c++
#pragma once
#include"qthread.h"
#include"qvector.h"
#include"qobject.h"
//æ–°å»ºéšæœºæ•°ç±»
class myThread :
    public QObject
{
    Q_OBJECT
public:
    myThread(QObject* parent = nullptr);
    void working(int num);//ç”Ÿæˆéšæœºæ•°
signals:
    void sendArray(QVector<int>num);//å‘é€
private:
    int m_num;
};

//æ–°å»ºå†’æ³¡æ’åºç±»
class BubbleSort :
    public QObject
{
    Q_OBJECT
public:
    BubbleSort(QObject* parent = nullptr);
    void working(QVector<int>list);//è¦æ¥æ”¶çš„æ˜¯æ’åºçš„æ•°

signals:
    void finish(QVector<int>list);//æ’åºå®Œæˆåå‘é€ä¸€ä¸ªfinishä¿¡å·

};
```

- **å­çº¿ç¨‹.cpp**

```c++
#include "myThread.h"
#include"qelapsedtimer.h"
#include"qdebug.h"

myThread::myThread(QObject* parent) :QObject(parent)
{

}
BubbleSort::BubbleSort(QObject* parent) : QObject(parent)
{

}


void myThread::working(int num)
{
    qDebug() << "child thread id" << QThread::currentThreadId();
    QVector<int> list;
    QElapsedTimer time;
    time.start();
    for (int i = 0; i < num; i++)
    {
        list.push_back(qrand() % 100000);
    }
    int milsec = time.elapsed();
    qDebug() << "The number of" << m_num << "generated";
    qDebug() << "shared" << milsec << "second";
    emit sendArray(list);
}


void BubbleSort::working(QVector<int>list)
{
    qDebug() << "BubbleSort thread id:" << QThread::currentThreadId();
    QElapsedTimer time;
    time.start();
    int temp;
    for (int i = 0; i < list.size(); ++i)
    {
        for (int j = 0; j < list.size()-i-1; ++j)
        {
            if (list[j] > list[j + 1])
            {
                temp = list[j];
                list[j] = list[j + 1];
                list[j + 1] = temp;
            }
        }
    }
    int milsec = time.elapsed();
    qDebug() << "shared" << milsec << "second";
    emit finish(list);
}
```

- **ä¸»çº¿ç¨‹.h**

```c++
#include <QtWidgets/QWidget>
#include"ui_list.h"

class list : public QWidget
{
    Q_OBJECT

public:
    list(QWidget *parent = Q_NULLPTR);
signals:
    void stating(int num);//è®¾ç½®è¦ç”Ÿæˆéšæœºæ•°ä¸ªæ•°

private:
    Ui::listClass ui;
};
```

- **ä¸»çº¿ç¨‹.cpp**

```c++
#include "list.h"
#include"myThread.h"
list::list(QWidget *parent)
    : QWidget(parent)
{
    ui.setupUi(this);
    //1.åˆ›å»ºQThreadå¯¹è±¡
    QThread* thread1 = new QThread;
    QThread* thread2 = new QThread;
    //2.åˆ›å»ºå­çº¿ç¨‹ç±»å¯¹è±¡
    myThread* myth = new myThread();
    BubbleSort* bub = new BubbleSort();
    //3é€šè¿‡movetothreadå°†å­çº¿ç¨‹å¯¹è±¡ç§»åŠ¨åˆ°QThreadå¯¹è±¡ä¸­
    myth->moveToThread(thread1);
    bub->moveToThread(thread2);
    //4å¯åŠ¨å­çº¿ç¨‹

    //å…ˆå‘å­çº¿ç¨‹å‘é€è¦ç”Ÿæˆçš„éšæœºæ•°ä¸ªæ•°
    connect(this,&list::stating, myth, &myThread::working);
    //å†å¯åŠ¨å­çº¿ç¨‹
    connect(ui.pushButton, &QPushButton::clicked,  [=]() {
        emit stating(1000);//ä¸»çº¿ç¨‹è®¾ç½®å­çº¿ç¨‹éšæœºæ•°çš„ä¸ªæ•°
        thread1->start();        
        });
    //å°†ç”Ÿæˆå¥½çš„éšæœºæ•°å‘é€ç»™BubbleSortç±»
    connect(myth, &myThread::sendArray, bub, &BubbleSort::working);

    //å°†ç”Ÿæˆå¥½çš„éšæœºæ•°æ˜¾ç¤ºåœ¨ç•Œé¢
    connect(myth, &myThread::sendArray,  [=](QVector<int>list) {
        for (int i = 0; i < list.size(); ++i)
        {
            ui.randlist->addItem(QString::number(list.at(i)));
        }
        });
    //å‘é€çš„åŒæ—¶å¯åŠ¨æ’åºç®—æ³•
    connect(myth, &myThread::sendArray, [=](QVector<int>list){
        thread2->start();
        });
    //å°†æ’åºå¥½çš„æ•°æ˜¾ç¤ºåœ¨ç•Œé¢
    connect(bub, &BubbleSort::finish, [=](QVector<int>list) {
        for (int i = 0; i < list. size(); ++i)
        {
            ui.bubblelist->addItem(QString::number(list.at(i)));
        }
        });
}
```

**ç»“è®º**

é€šè¿‡å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š

- ç”±äºç¬¬äºŒç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å¸¦å‚çš„å­çº¿ç¨‹è¿è¡Œå‡½æ•°ï¼Œå› æ­¤ä»£ç æ›´åŠ ç®€æ´ã€‚
- åœ¨ç¬¬äºŒç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥éšæ„ä¿®æ”¹éœ€è¦åœ¨å“ªä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œä»£ç ä¹Ÿæ›´åŠ çµæ´»ã€‚
- ç¬¬ä¸€ç§æ–¹æ³•é€‚åˆåœ¨çº¿ç¨‹ä¸­å¤„ç†å•ä¸€äº‹ä»¶ï¼Œå…¶é€»è¾‘ç®€å•ï¼ˆåªéœ€è¦æ–°å»ºä¸€ä¸ªç»§æ‰¿è‡ªQThreadç±»çš„å¯¹è±¡ï¼Œé‡å†™runå‡½æ•°ï¼Œç„¶åå¯åŠ¨å³å¯ï¼‰ï¼Œå¯¹äºéœ€è¦åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¤„ç†å¤šä¸ªäº‹ä»¶ï¼Œè¿˜æ˜¯ç”¨ç¬¬äºŒç§æ–¹æ³•æ¯”è¾ƒå¥½ã€‚
- ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ç¬¬äºŒç§æ–¹æ³•ä¸­ï¼Œç»™å®šä¹‰çš„å­çº¿ç¨‹å¯¹è±¡æ·»åŠ çˆ¶ç±»å‘¢ï¼Ÿ ï¼šç”±äºæ·»åŠ äº†çˆ¶ç±»ä»¥åå°±ä¸èƒ½å†ç§»åŠ¨åˆ°QThreadä¸­å»äº†

**å¦‚ä½•è¿›è¡Œçº¿ç¨‹èµ„æºçš„é‡Šæ”¾ï¼Ÿ**

1. åœ¨newå¯¹è±¡æ—¶å€™ï¼Œç›´æ¥ç”¨thisæŒ‡å®šå…¶çˆ¶ç±»ï¼ˆå³æ”¾å…¥å¯¹è±¡æ•°ä¸­ï¼‰
2. åœ¨ç¨‹åºæœ€åè‡ªè¡Œé‡Šæ”¾èµ„æº

```c++
    connect(this, &list::destroyed, this, [=]() {
        thread1->quit();
        thread1->wait();
        thread1->deleteLater();
        thread2->quit();
        thread2->wait();
        thread2->deleteLater();
        myth->deleteLater();
        bub->deleteLater();
        });
```

<br>

<br>

<br>

<span style="color: red; font-size: 20px;">è½¬è½½è‡ªï¼š[å”¯æœ‰è‡ªå·±å¼ºå¤§](https://www.cnblogs.com/xyf327)          å¦‚æœ‰ä¾µæƒï¼Œåœ¨ä¸‹æ–¹è¯„è®º  ç«‹åˆ»åˆ é™¤ã€‚</span>